<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowCraft â€¢ Dashboard</title>
    {% include 'partials/head.html' %}
    <link rel="stylesheet" href="/static/css/pages/dashboard.css">
    <!-- existing styles remain last for full fidelity -->
    <link rel="stylesheet" href="/static/css/index.css">
    
    {% include 'base/foot.html' %}
</head>
<body>
    <div class="app_container">
        {% include 'partials/navigation.html' %}
        <div class="main_content full_width">
            <div class="dashboard_container">

                <!-- quick stats grid -->
                <div class="dash_card">
                    <div class="dash_title">quick stats</div>
                    <div class="kpi_grid">
                        <div class="kpi_card">
                            <div class="kpi_title">executions</div>
                            <div class="kpi_value" id="kpi_total_exec">0</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">history</span> total runs</div>
                        </div>
                        <div class="kpi_card">
                            <div class="kpi_title">progress rate</div>
                            <div class="kpi_value" id="kpi_success_rate">0%</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">check_circle</span> average</div>
                        </div>
                        <div class="kpi_card">
                            <div class="kpi_title">average run time</div>
                            <div class="kpi_value" id="kpi_avg_time">0.000s</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">schedule</span> per execution</div>
                        </div>
                        <div class="kpi_card">
                            <div class="kpi_title">node coverage</div>
                            <div class="kpi_value" id="kpi_nodes_cov">0/0</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">device_hub</span> nodes with files</div>
                        </div>
                        <div class="kpi_card">
                            <div class="kpi_title">unassigned python nodes</div>
                            <div class="kpi_value" id="kpi_missing">0</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">warning</span> python nodes without files</div>
                        </div>
                        <div class="kpi_card">
                            <div class="kpi_title">orphaned nodes</div>
                            <div class="kpi_value" id="kpi_orphan">0</div>
                                <div class="kpi_sub"><span class="material-icons u_mr_4 u_icon_16">device_hub</span> nodes with no links</div>
                        </div>
                    </div>
                </div>

                <div class="dash_columns">
                    <div class="dash_col_left">
                        <!-- recent executions -->
                        <div class="dash_card">
                            <div class="dash_title">recent executions</div>
                            <div class="table_wrap">
                                <table class="table">
                                    <colgroup>
                                        <col style="width: calc((100% - 112px) / 4);">
                                        <col style="width: calc((100% - 112px) / 4);">
                                        <col style="width: calc((100% - 112px) / 4);">
                                        <col style="width: calc((100% - 112px) / 4);">
                                        <col style="width: 112px;">
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>status</th>
                                            <th>nodes</th>
                                            <th>progress %</th>
                                            <th>elapsed</th>
                                            <th class="right">actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent_tbody">
                                        <tr><td colspan="5" class="muted" style="text-align:center; padding:14px;">loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- execution distribution -->
                        <div class="dash_card">
                            <div class="dash_title">execution progress history</div>
                            <div id="distribution_bars" class="chart_bar_row"></div>
                        </div>
                    </div>

                    <div class="dash_col_right">
                        <!-- quick actions -->
                        <div class="dash_card">
                            <div class="dash_title">quick actions</div>
                            <div class="btn_row">
                                <button id="link_build" class="mini_btn"><span class="material-icons" style="font-size:16px;">build</span> Build</button>
                                <button id="link_run" class="mini_btn"><span class="material-icons" style="font-size:16px;">play_arrow</span> Run</button>
                                <button id="link_scripts" class="mini_btn"><span class="material-icons" style="font-size:16px;">code</span> Scripts</button>
                                <button id="link_data" class="mini_btn"><span class="material-icons" style="font-size:16px;">table_chart</span> Data Matrix</button>
                                <div class="u_flex_grow_1"></div>
                                <button id="btn_clear_history" class="mini_btn mini_btn_danger"><span class="material-icons" style="font-size:16px;">delete</span> Clear History</button>
                            </div>
                        </div>

                        <!-- choose default editor -->
                        <div class="dash_card">
                            <div class="dash_title">choose default editor</div>
                            <div class="form_group">
                                <label class="form_label">default editor</label>
                                <div class="dropdown_container">
                                    <input type="text" id="default_editor_input" class="form_input dropdown_input" placeholder="detecting installed editors..." readonly>
                                    <span class="dropdown_arrow material-icons">arrow_drop_down</span>
                                    <div class="dropdown_menu" id="default_editor_dropdown">
                                        <div class="dropdown_loading">scanning editors...</div>
                                    </div>
                                </div>
                                <div style="font-size: 0.75rem; color: var(--on-surface); opacity: 0.7; margin-top: 6px;">used when opening files from the app</div>
                            </div>
                        </div>

                        <!-- failure spotlight -->
                        <div class="dash_card">
                            <div class="dash_title">failure spotlight</div>
                            <div id="failure_block"></div>
                        </div>
                    </div>
                </div>

            </div>
            {% include 'partials/status_bar.html' %}
        </div>
    </div>
    {% include 'partials/modals/create_flowchart.html' %}
    
    <!-- dashboard page functionality -->
    <script src="/static/js/pages/Dashboard.js"></script>
</body>
</html>


