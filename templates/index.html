<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowCraft</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    
    <!-- material ui css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- d3.js for flowchart -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <style>
        :root {
            --primary-color: #1976d2;
            --primary-dark: #0d47a1;
            --secondary-color: #424242;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --surface-variant: #2d2d2d;
            --on-background: #ffffff;
            --on-surface: #ffffff;
            --on-primary: #ffffff;
            --border-color: #3d3d3d;
            --hover-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--on-background);
            height: 100vh;
            overflow: hidden;
        }

        /* ensure most ui text inherits roboto */
        html, body, .app_container, .sidebar, .properties_sidebar, .main_content,
        .sidebar_item, .sidebar_section_title, .sidebar_title, .status_bar,
        button, input, select, textarea, label, .dropdown_item, .dropdown_loading, .dropdown_no_results,
        .modal_title, .btn {
            font-family: 'Roboto', sans-serif;
        }

        .app_container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 320px;
            height: 100vh;
            background: linear-gradient(180deg, var(--surface-color) 0%, var(--surface-variant) 100%);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
        }

        .properties_sidebar {
            width: 320px;
            height: 100vh;
            background-color: var(--surface-color);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 1000;
        }

        .properties_content {
            display: none;
        }

        .properties_content.active {
            display: block;
            flex: 1;
            overflow-y: auto;
        }

        .sidebar_header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 16px;
            background: transparent;
        }

        .sidebar_title {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
            letter-spacing: 0.5px;
        }

        /* simple geometric logo for flowcraft */
        .app_logo {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
        }
        .app_logo .logo_node {
            fill: var(--surface-variant);
            stroke: var(--primary-color);
            stroke-width: 2px;
        }
        .app_logo .logo_center {
            fill: var(--primary-color);
            stroke: var(--on-primary);
            stroke-width: 1.5px;
        }
        .app_logo .logo_connector {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 2px;
            stroke-linecap: round;
        }

        .sidebar_content {
            flex: 1;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        /* keep the settings button pinned to the bottom */
        .sidebar_footer {
            margin-top: auto;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
        }

        .sidebar_section {
            margin-bottom: 24px;
        }

        .sidebar_section_title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--on-surface);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .sidebar_item {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            padding-left: 14px;
            padding-right: 18px;
            padding-bottom: 12px;
            padding-top: 12px;
            margin-bottom: 10px;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            color: var(--on-surface);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: capitalize;
            letter-spacing: 0.5px;
            opacity: 0.95;
        }

        .sidebar_item:hover {
            background: linear-gradient(135deg, var(--hover-color) 0%, rgba(51, 51, 51, 0.9) 100%);
        }

        .sidebar_item.active {
            background: #484848;
            color: var(--on-primary);
        }

        .sidebar_section.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        .sidebar_section.disabled .sidebar_item {
            cursor: not-allowed;
        }

        .btn_create {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%) !important;
            color: white !important;
        }

        .btn_create:hover {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%) !important;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            margin-top: 0px;
        }

        .create_flowchart_link_container {
            margin-top: -10px;
            text-align: right;
        }

        .create_flowchart_link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #4caf50;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 6px 12px;
            padding-left: 0px;
            border-radius: 4px;
            transition: all 0.2s ease;
            text-transform: lowercase;
        }

        .create_flowchart_link .span {
            margin-top: 1px;
        }

        .create_flowchart_link:hover {
            background: transparent;
            color: #4caf50;
            text-decoration: none; /* prevent icon underline; underline text via child span */
        }

        /* underline only the text part on hover */
        .create_flowchart_link:hover .create_link_text {
            text-decoration: underline;
        }

        .create_flowchart_link .material-icons {
            font-size: 16px;
            text-decoration: none;
        }

        /* ensure plus icons are never underlined on hover */
        .create_flowchart_link .material-icons,
        .create_flowchart_link:hover .material-icons {
            text-decoration: none;
        }

        .dropdown_delete_btn {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dropdown_delete_btn:hover {
            background: rgba(244, 67, 54, 0.1);
        }

        .dropdown_delete_btn .material-icons {
            font-size: 16px;
        }

        .variable_item {
            background: var(--surface-variant);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-color);
        }

        .variable_name {
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .variable_type {
            font-size: 0.75rem;
            background: rgba(25, 118, 210, 0.1);
            color: var(--primary-color);
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
            margin-right: 8px;
        }

        .variable_confidence {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }

        .confidence_high {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }

        .confidence_medium {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .confidence_low {
            background: rgba(158, 158, 158, 0.1);
            color: #9e9e9e;
        }

        .variable_details {
            font-size: 0.8em;
            color: var(--on-surface);
            opacity: 0.8;
            margin-top: 4px;
        }

        .sidebar_item .material-icons {
            margin-right: 12px;
            font-size: 20px;
            width: 26px;
        }

        .main_content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--background-color);
            margin-right: 320px;
        }

        .main_content.full_width {
            margin-right: 0;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ensure icons and text are vertically centered inside buttons */
        .btn .material-icons {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            font-size: 18px;
        }
        .btn .btn_label {
            display: inline-flex;
            align-items: center;
        }

        .btn_primary {
            background-color: var(--primary-color);
            color: var(--on-primary);
        }

        .btn_primary:hover {
            background-color: var(--primary-dark);
        }

        .btn_secondary {
            background-color: var(--surface-variant);
            color: var(--on-surface);
        }

        .btn_secondary:hover {
            background-color: var(--hover-color);
        }

        /* subtle danger button for destructive actions in dark mode */
        .btn_danger_subtle {
            background-color: #2A0E0E;
            color: #ffffff;
            border: none;
            justify-content: center;
        }

        .btn_danger_subtle:hover {
            background-color: #3a1414;
            color: #ffffff;
            box-shadow: 0 2px 10px rgba(42, 14, 14, 0.3);
        }

        .btn_danger_subtle .material-icons {
            color: #ffffff;
        }

        .canvas_container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* full page settings container */
        .settings_page {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background-color: var(--background-color);
        }

        #flowchart_canvas {
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
        }

        .node {
            fill: var(--surface-color);
            stroke: var(--border-color);
            stroke-width: 2px;
            cursor: pointer;
        }
        
        .node:not(.dragging) {
            transition: all 0.2s ease;
        }

        .node:hover {
            fill: var(--surface-variant);
            stroke: var(--primary-color);
        }

        .node.selected {
            fill: var(--primary-color);
            stroke: var(--primary-dark);
        }

        .node.multi_selected {
            fill: var(--secondary-color);
            stroke: var(--primary-color);
            stroke-width: 3px;
        }

        .node.selection_preview {
            fill: rgba(74, 165, 245, 0.3);
            stroke: #4aa5f5;
            stroke-width: 2px;
            stroke-dasharray: 3,3;
        }

        .group_container {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 2px;
            stroke-dasharray: 8,4;
            opacity: 0.7;
        }

        .group_container.selected {
            stroke: var(--primary-color);
            stroke-width: 3px;
            opacity: 1;
        }

        .group_label {
            fill: var(--primary-color);
            font-size: 12px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
        }

        .group_label.selected {
            font-weight: bold;
        }

        .node_text {
            fill: var(--on-surface);
            text-anchor: middle;
            dominant-baseline: middle;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            pointer-events: none;
        }

        .link {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 2px;
            cursor: pointer;
        }

        .link:hover {
            stroke: var(--primary-color);
        }

        .link.selected {
            stroke: var(--primary-color);
            stroke-width: 3px;
        }

        .link.input_connection {
            stroke: var(--border-color);
            stroke-width: 2px;
            stroke-dasharray: 8,4;
            opacity: 0.7;
        }

        .link.input_connection:hover {
            stroke: var(--border-color);
            opacity: 0.8;
        }

        .connection_dot {
            fill: var(--primary-color);
            stroke: var(--on-primary);
            stroke-width: 2px;
            cursor: crosshair;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .node-group:hover .connection_dot {
            opacity: 1;
        }

        /* hide connection dots in run mode */
        .run_mode .node-group:hover .connection_dot {
            opacity: 0;
        }

        /* node execution states */
        .node.running {
            fill: #2196f3 !important;
            stroke: #1976d2 !important;
        }

        .node.completed {
            fill: #4caf50 !important;
            stroke: #388e3c !important;
        }

        .node.error {
            fill: #f44336 !important;
            stroke: #d32f2f !important;
        }

        /* input node styles */
        .node.input_node {
            fill: var(--surface-variant);
            stroke: var(--border-color);
            stroke-width: 2px;
        }
        
        .node.input_node.selected {
            stroke: var(--primary-color);
        }

        .node.input_node:hover {
            fill: #3d3d3d;
            stroke: #42a5f5;
        }



        .input_param_label {
            font-size: 14px;
            font-weight: 500;
            fill: var(--on-surface);
            text-anchor: start; /* pin label to left of node */
            /* prevent accidental selection or clicks on the label */
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            pointer-events: none;
            cursor: default;
        }

        .input_field_bg {
            fill: var(--background-color);
            stroke: var(--border-color);
            stroke-width: 1px;
        }

        .input_field_bg:hover {
            stroke: var(--primary-color);
        }

        .input_field_text {
            font-size: 14px;
            fill: var(--on-surface);
            text-anchor: start;
            pointer-events: none;
        }

        .refresh_button_bg {
            fill: var(--primary-color);
        }

        .refresh_button_bg:hover {
            fill: #42a5f5;
        }

        .refresh_button {
            margin-top: 4px;
            margin-bottom: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .refresh_button_text {
            font-size: 12px;
            font-weight: bold;
            fill: var(--on-primary);
            pointer-events: none;
        }

        /* loading icon for running nodes */
        .node_loading_icon {
            animation: spin 1s linear infinite;
        }

        /* loading circle animation around nodes */
        .node_loading_circle {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* play button styles */
        .play_button {
            transition: opacity 0.2s ease, transform 0.2s ease;
            transform-origin: center;
        }

        .play_button:hover {
            transform: scale(1.1);
        }

        .play_button_bg {
            transition: fill 0.2s ease;
        }

        .play_button:hover .play_button_bg {
            fill: #66BB6A !important;
        }

        .connection_line {
            stroke: var(--primary-color);
            stroke-width: 2px;
            stroke-dasharray: 5,5;
            fill: none;
            pointer-events: none;
        }

        .form_group {
            margin-bottom: 16px;
        }

        .form_label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--on-surface);
            margin-bottom: 8px;
        }

        .form_input {
            width: 100%;
            padding: 12px;
            background-color: var(--surface-variant);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--on-surface);
            font-size: 0.875rem;
        }

        .form_input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form_textarea {
            width: 100%;
            padding: 12px;
            background-color: var(--surface-variant);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--on-surface);
            font-size: 0.875rem;
            resize: vertical;
            min-height: 80px;
        }

        .form_textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .status_bar {
            height: 32px;
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 0.75rem;
            color: var(--on-surface);
        }

        .coordinate_input {
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 2px;
            color: var(--on-surface);
            font-size: 0.75rem;
            padding: 2px 4px;
            text-align: center;
            outline: none;
        }

        .coordinate_input:focus {
            border-color: var(--primary-color);
            background: var(--surface-variant);
        }

        .coordinate_input:hover {
            border-color: var(--primary-color);
        }

        /* remove spinner buttons from number inputs */
        .coordinate_input::-webkit-outer-spin-button,
        .coordinate_input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .coordinate_input[type=number] {
            -moz-appearance: textfield;
        }

        /* context menu */
        .context_menu {
            position: absolute;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 0;
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .context_menu_item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--on-surface);
        }

        .context_menu_item:hover {
            background-color: var(--hover-color);
        }

        /* responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 240px;
            }
        }

        .node_order_circle {
            fill: var(--primary-color);
            stroke: var(--on-primary);
            stroke-width: 2px;
        }

        .node_order_text {
            fill: var(--on-primary);
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }

        /* run view styles */
        .sidebar_item.flow_view_active {
            background-color: #484848;
            color: var(--on-primary);
        }

        .sidebar_item.flow_view_active:hover {
            background-color: #555555;
        }

        /* mode styles */
        .sidebar_item.run_mode_active {
            background-color: #484848;
            color: var(--on-primary);
        }

        .sidebar_item.run_mode_active:hover {
            background-color: #555555;
        }

        .start_button_container {
            position: absolute;
            top: 20px;
            left: 280px; /* positioned to the right of the sidebar (260px width + 20px margin) */
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn_stop {
            background-color: #f44336 !important;
            color: white !important;
        }

        .btn_stop:hover {
            background-color: #d32f2f !important;
        }

        .loading_wheel {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* floating toolbar */
        .floating_toolbar {
            position: absolute;
            top: 14px;
            left: 335px; /* positioned to the left of properties sidebar */
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .toolbar_btn {
            width: 40px;
            height: 40px;
            background: var(--surface-variant);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 0;
        }

        .toolbar_btn:hover {
            background: var(--hover-color);
            border-color: var(--primary-color);
        }

        .toolbar_btn.active {
            background: var(--primary-color);
            color: var(--on-primary);
            border-color: var(--primary-color);
        }

        .toolbar_btn .material-icons {
            font-size: 20px;
        }

        /* run mode - expanded properties sidebar */
        .main_content.run_mode {
            margin-right: 450px;
        }

        .properties_sidebar.run_mode {
            width: 450px;
        }

        /* history view width */
        .main_content.history_mode {
            margin-right: 430px;
        }

        .properties_sidebar.history_mode {
            width: 430px;
        }

        .properties_sidebar.run_mode .properties_content.active {
            display: flex !important;
            flex-direction: column;
            width: 100%;
            flex: 1;
            overflow: hidden;
        }

        .properties_sidebar.run_mode .sidebar_content {
            flex: 1;
            width: 100%;
            border-right: none;
            overflow-y: auto;
        }

        .properties_sidebar.run_mode .sidebar_content:last-child {
            border-right: none;
        }

        /* pin footer actions at bottom of properties sidebar */
        .properties_footer {
            border-top: 1px solid var(--border-color);
            padding: 12px;
            background: var(--surface-color);
            display: none; /* hidden by default; shown when actionable selection exists */
            gap: 8px;
        }
        .properties_footer .btn {
            width: 100%;
        }
        
        /* default properties layout when no selection */
        #default_properties .sidebar_content {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        /* hide legacy per-panel delete buttons to avoid duplicates */
        #delete_node_from_sidebar,
        #delete_selected_nodes,
        #delete_link_btn,
        #delete_group { display: none !important; }

        /* dropdown styles */
        .dropdown_container {
            position: relative;
        }

        .dropdown_input {
            cursor: pointer;
            padding-right: 40px;
        }

        .dropdown_arrow {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--on-surface);
            pointer-events: none;
            font-size: 20px;
        }

        .dropdown_menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--surface-variant);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .dropdown_menu.show {
            display: block;
        }

        .dropdown_item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .dropdown_item:last-child {
            border-bottom: none;
        }

        .dropdown_item:hover {
            background-color: var(--hover-color);
        }

        .dropdown_item.selected {
            background-color: var(--primary-color);
            color: var(--on-primary);
        }

        .dropdown_item_name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .dropdown_item_path {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .dropdown_item_content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dropdown_loading {
            padding: 12px;
            text-align: center;
            color: var(--on-surface);
            opacity: 0.7;
            font-size: 0.875rem;
        }

        .dropdown_no_results {
            padding: 12px;
            text-align: center;
            color: var(--on-surface);
            opacity: 0.7;
            font-size: 0.875rem;
        }

        /* modal styles */
        .modal_overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal_overlay.show {
            display: flex;
        }

        .modal_content {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 24px;
            min-width: 400px;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        /* removed slide-in animation for lightboxes */

        /* move create flowchart modal upward */
        #create_flowchart_modal .modal_content {
            margin-top: -50px;
        }

        .modal_header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal_title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--on-surface);
        }

        .modal_close {
            background: none;
            border: none;
            color: var(--on-surface);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .modal_close:hover {
            background-color: var(--hover-color);
        }

        .modal_actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn_modal {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .btn_modal_primary {
            background-color: var(--primary-color);
            color: var(--on-primary);
        }

        .btn_modal_primary:hover {
            background-color: var(--primary-dark);
        }

        .btn_modal_secondary {
            background-color: var(--surface-variant);
            color: var(--on-surface);
        }

        .btn_modal_secondary:hover {
            background-color: var(--hover-color);
        }

        /* input with fixed suffix styling */
        .input_with_suffix {
            position: relative;
        }
        .input_with_suffix .form_input {
            padding-right: 56px;
        }
        .input_suffix {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.7;
            pointer-events: none;
            font-family: monospace;
            font-size: 0.9rem;
        }

        /* hover state for create python script button - keep consistent and no background change */
        #create_python_script_btn:hover {
            background: transparent;
            border-radius: 4px;
        }

        /* underline only the text for the create python script button */
        #create_python_script_btn:hover .create_python_script_btn_span { text-decoration: none; }
        #create_python_script_btn:hover .create_python_script_text { text-decoration: underline; }

        /* adjust position of create python modal upward */
        #create_python_modal .modal_content {
            margin-top: -50px;
        }

        /* mini folder explorer styles */
        .mini_explorer { border: 1px solid var(--border-color); border-radius: 8px; background: var(--surface-variant); padding: 10px; }
        .mini_explorer_toolbar { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; background: var(--surface-color); border: 1px solid var(--border-color); border-radius: 6px; padding: 6px; }
        .mini_btn { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border: 1px solid var(--border-color); background: var(--surface-variant); color: var(--on-surface); border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
        .mini_btn:hover { background: var(--hover-color); }
        .mini_breadcrumb { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; font-size: 0.85rem; margin-bottom: 6px; }
        .mini_breadcrumb_item { cursor: pointer; color: #90caf9; }
        .mini_breadcrumb_sep { opacity: 0.6; }
        .mini_list { max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; background: var(--surface-color); }
        .mini_row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-bottom: 1px solid var(--border-color); cursor: pointer; }
        .mini_row:last-child { border-bottom: none; }
        .mini_row:hover { background: var(--hover-color); }

        /* history entry styles */
        .history_entry {
            background: var(--surface-variant);
            border-radius: 0px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-color);
            transition: all 0.2s ease;
        }

        .history_entry:hover {
            background: var(--hover-color);
        }

        .history_entry.success {
            border-left-color: #4caf50;
        }

        .history_entry.failed {
            border-left-color: #f44336;
        }

        .history_entry.stopped {
            border-left-color: #ff9800;
        }

        .history_entry_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history_entry_time {
            font-weight: 500;
            color: var(--on-surface);
            font-size: 0.9em;
        }

        .history_entry_status {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 500;
        }

        .history_entry_status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }

        .history_entry_status.failed {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }

        .history_entry_status.stopped {
            background: rgba(255, 152, 0, 0.1);
            color: #ff9800;
        }

        .history_entry_stats {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
            font-size: 0.8em;
            color: var(--on-surface);
            opacity: 0.8;
        }

        .history_entry_actions {
            display: flex;
            gap: 8px;
        }

        .history_entry_btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .history_entry_btn.view {
            background-color: var(--primary-color);
            color: var(--on-primary);
        }

        .history_entry_btn.view:hover {
            background-color: var(--primary-dark);
        }

        .history_entry_btn.delete {
            background-color: #f44336;
            color: white;
        }

        .history_entry_btn.delete:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="app_container">
        <!-- sidebar -->
        <div class="sidebar">
            <div class="sidebar_header">
                <!-- simple geometric logo -->
                <svg class="app_logo" viewBox="0 0 24 24" aria-hidden="true">
                    <!-- left node -->
                    <rect class="logo_node" x="2" y="3" width="6" height="6" rx="1.5" />
                    <!-- center node -->
                    <circle class="logo_center" cx="12" cy="12" r="3" />
                    <!-- right node -->
                    <rect class="logo_node" x="16" y="15" width="6" height="6" rx="1.5" />
                    <!-- connectors -->
                    <path class="logo_connector" d="M8 6 H12 V9" />
                    <path class="logo_connector" d="M12 15 H16 V18" />
                </svg>
                <h1 class="sidebar_title">FlowCraft</h1>
            </div>
            <div class="sidebar_content">
                <div class="sidebar_section">
                    <h3 class="sidebar_section_title">ACTIONS</h3>
                    <button class="sidebar_item" id="build_btn">
                        <span class="material-icons">build</span>
                        Build
                    </button>
                    <button class="sidebar_item" id="scripts_btn">
                        <span class="material-icons">code</span>
                        Scripts
                    </button>
                    <button class="sidebar_item" id="run_btn">
                        <span class="material-icons">play_arrow</span>
                        Run
                    </button>
                    <button class="sidebar_item" id="history_btn">
                        <span class="material-icons">history</span>
                        History
                    </button>
                </div>
                <div class="sidebar_section" id="add_node_section">
                    <h3 class="sidebar_section_title">ADD NODE</h3>
                    <button class="sidebar_item" id="python_node_btn">
                        <span class="material-icons">code</span>
                        python node
                    </button>
                    <button class="sidebar_item" id="if_condition_btn">
                        <span class="material-icons">alt_route</span>
                        if condition
                    </button>
                </div>
                <div class="sidebar_section">
                    <h3 class="sidebar_section_title">TOOLS</h3>
                    <button class="sidebar_item" id="export_btn">
                        <span class="material-icons">download</span>
                        export
                    </button>
                </div>
                <div class="sidebar_section">
                    <h3 class="sidebar_section_title">FLOWCHART</h3>
                    <div class="form_group">
                        <div class="dropdown_container">
                            <input type="text" id="flowchart_selector" class="form_input dropdown_input" placeholder="select flowchart..." readonly>
                            <span class="dropdown_arrow material-icons">arrow_drop_down</span>
                            <div class="dropdown_menu" id="flowchart_dropdown">
                                <div class="dropdown_loading">loading flowcharts...</div>
                            </div>
                        </div>
                    </div>
                    <div class="create_flowchart_link_container">
                        <a href="#" class="create_flowchart_link" id="create_flowchart_btn" style="padding-right: 4px;">
                            <span class="material-icons">add</span>
                            <span class="create_link_text">create new flowchart</span>
                        </a>
                    </div>
                </div>
                <div class="sidebar_footer">
                    <button class="sidebar_item" id="settings_btn" title="settings" style="margin-bottom:-8px">
                        <span class="material-icons">settings</span>
                        settings
                    </button>
                </div>
            </div>
        </div>

        <!-- main content -->
        <div class="main_content">
            <!-- start button in top left -->
            <div class="start_button_container" id="start_button_container" style="display: none;">
                <button class="btn btn_primary" id="execute_start_btn" style="margin-left: 126px; margin-top:-5px;">
                    <span class="material-icons">play_arrow</span>
                    START
                </button>
                <div class="loading_wheel" id="execution_loading_wheel" style="display: none;"></div>
                <button class="btn btn_secondary" id="execute_clear_btn" title="clear" style="margin-top:-40px; margin-left: 245px;">
                    <span class="material-icons">brush</span>
                    CLEAR
                </button>
            </div>
            
            <!-- floating toolbar -->
            <div class="floating_toolbar" id="floating_toolbar">
                <button class="toolbar_btn" id="flow_toggle_btn" title="Toggle Flow View">
                    <span class="material-icons">device_hub</span>
                </button>
                <button class="toolbar_btn" id="group_select_btn" title="Group Select Tool">
                    <span class="material-icons">select_all</span>
                </button>
                <button class="toolbar_btn" id="deselect_btn" title="Deselect All">
                    <span class="material-icons">pan_tool</span>
                </button>
            </div>
            
            <div class="canvas_container">
                <svg id="flowchart_canvas">
                    <g id="zoom_group">
                        <!-- Placeholder for node order numbers -->
                        <text class="node_order" x="0" y="0" visibility="hidden">0</text>
                    </g>
                </svg>
            </div>

            <!-- full page settings -->
            <div class="settings_page" id="settings_page">
                <div style="max-width: 900px; margin: 0 auto;">
                    <h3 class="sidebar_section_title" style="margin-bottom: 16px;">settings</h3>

                    <div class="form_group">
                        <label class="form_label">default editor</label>
                        <div class="dropdown_container">
                            <input type="text" id="default_editor_input" class="form_input dropdown_input" placeholder="detecting installed editors..." readonly>
                            <span class="dropdown_arrow material-icons">arrow_drop_down</span>
                            <div class="dropdown_menu" id="default_editor_dropdown">
                                <div class="dropdown_loading">scanning editors...</div>
                            </div>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--on-surface); opacity: 0.7; margin-top: 6px;">used when opening files from the app</div>
                    </div>

                    <div class="form_group">
                        <label class="form_label">appearance</label>
                        <div style="background: var(--surface-variant); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span class="material-icons" style="font-size: 18px; color: var(--on-surface); opacity: 0.8;">palette</span>
                                <span style="font-size: 0.9rem;">theme</span>
                                <span style="font-size: 0.75rem; opacity: 0.7; margin-left: auto;">coming soon</span>
                            </div>
                        </div>
                    </div>

                    <div class="form_group">
                        <label class="form_label">behavior</label>
                        <div style="background: var(--surface-variant); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span class="material-icons" style="font-size: 18px; color: var(--on-surface); opacity: 0.8;">save</span>
                                <span style="font-size: 0.9rem;">autosave</span>
                                <span style="font-size: 0.75rem; opacity: 0.7; margin-left: auto;">coming soon</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status_bar">
                <span id="node_count">nodes: 0</span>
                <span id="status_text" style="margin-left: 16px;">ready - click to add nodes, drag to connect</span>
                <div style="flex: 1;"></div>
                <div id="status_progress" style="display:none; width: 160px; height: 8px; background: rgba(255,255,255,0.08); border-radius: 4px; overflow: hidden; margin-right: 16px;">
                    <div id="status_progress_bar" style="width: 0%; height: 100%; background: #7e57c2; transition: width 120ms ease;"></div>
                </div>
                <div id="node_coordinates" style="margin-right: 16px; opacity: 0.7; display: flex; align-items: center; gap: 8px;">
                    <span>x:</span>
                    <input type="number" id="node_x" class="coordinate_input" style="width: 50px; display: none;" title="x coordinate">
                    <span>y:</span>
                    <input type="number" id="node_y" class="coordinate_input" style="width: 50px; display: none;" title="y coordinate">
                    <div style="width: 16px;"></div>
                    <span>w:</span>
                    <input type="number" id="node_width" class="coordinate_input" style="width: 50px; display: none;" title="width">
                    <span>h:</span>
                    <input type="number" id="node_height" class="coordinate_input" style="width: 50px; display: none;" title="height">
                </div>
            </div>
        </div>
    </div>

    <!-- context menu -->
    <div class="context_menu" id="context_menu">
        <div class="context_menu_item" id="edit_node">edit node</div>
        <div class="context_menu_item" id="delete_node">Delete Node</div>
    </div>

        <!-- properties sidebar -->
        <div class="properties_sidebar" id="properties_sidebar">
        
        <!-- default state -->
        <div class="properties_content active" id="default_properties">
            <div class="sidebar_content">
                <div style="text-align: center; padding: 40px 20px; color: var(--on-surface); opacity: 0.7;">
                    <span class="material-icons" style="font-size: 48px; margin-bottom: 16px;">info</span>
                    <p>select nodes to view properties</p>
                    <p style="font-size: 0.8em; margin-top: 8px;">shift+click for multi-select</p>
                </div>
            </div>
        </div>

        <!-- settings moved to full page; this legacy panel is removed -->

        <!-- single node properties -->
        <div class="properties_content" id="single_node_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label" for="node_name">node name</label>
                    <input type="text" id="node_name" class="form_input" placeholder="enter node name">
                </div>
                <div class="form_group">
                    <label class="form_label" for="python_file">python file</label>
                    <div class="dropdown_container">
                        <input type="text" id="python_file" class="form_input dropdown_input" placeholder="search python files..." readonly>
                        <span class="dropdown_arrow material-icons">arrow_drop_down</span>
                        <div class="dropdown_menu" id="python_file_dropdown">
                            <div class="dropdown_loading">loading files...</div>
                        </div>
                    </div>
                    <div class="create_flowchart_link_container" style="margin-top: 8px; text-align: left;">
                        <button type="button" id="create_python_script_btn" class="create_flowchart_link" style="background: none; border: none; cursor: pointer; margin-top: -6px;">
                            <span class="material-icons create_python_script_btn_span" style="margin-top:1px">add</span>
                            <span class="create_python_script_text">create python script</span>
                        </button>
                    </div>
                </div>

                <div class="form_group" id="arguments_section" style="display: none; flex: 1;">
                    <label class="form_label">arguments (data in)</label>
                    <div id="arguments_list" style="flex: 1; display: flex; flex-direction: column; background: var(--surface-variant); border-radius: 4px; padding: 8px;">
                        <div id="arguments_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">hourglass_empty</span>
                            <p style="font-size: 0.8em;">analyzing function...</p>
                        </div>
                        <div id="arguments_content" style="display: none; flex: 1;">
                            <!-- arguments will be populated here -->
                        </div>
                        <div id="arguments_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">info</span>
                            <p style="font-size: 0.8em;">no arguments found</p>
                        </div>
                    </div>
                </div>
                <div class="form_group" id="returns_section" style="display: none; flex: 1;">
                    <label class="form_label">returns (data out)</label>
                    <div id="returns_list" style="flex: 1; display: flex; flex-direction: column; background: var(--surface-variant); border-radius: 4px; padding: 8px;">
                        <div id="returns_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">hourglass_empty</span>
                            <p style="font-size: 0.8em;">analyzing function...</p>
                        </div>
                        <div id="returns_content" style="display: none; flex: 1;">
                            <!-- returns will be populated here -->
                        </div>
                        <div id="returns_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">info</span>
                            <p style="font-size: 0.8em;">no return values found</p>
                        </div>
                    </div>
                </div>

                <!-- if node variables section -->
                <div class="form_group" id="if_node_variables_section" style="display: none; flex: 1;">
                    <label class="form_label">available variables</label>
                    <div id="if_node_variables_list" style="flex: 1; display: flex; flex-direction: column; background: var(--surface-variant); border-radius: 4px; padding: 8px;">
                        <div id="if_node_variables_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">hourglass_empty</span>
                            <p style="font-size: 0.8em;">analyzing connected python nodes...</p>
                        </div>
                        <div id="if_node_variables_content" style="display: none; flex: 1;">
                            <!-- if node variables will be populated here -->
                        </div>
                        <div id="if_node_variables_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">info</span>
                            <p style="font-size: 0.8em;">no variables available</p>
                            <p style="font-size: 0.7em; margin-top: 4px;">connect to a python node to see available variables</p>
                        </div>
                        <div id="if_node_variables_error" style="display: none; text-align: center; padding: 20px; color: #f44336;">
                            <span class="material-icons" style="font-size: 16px; margin-bottom: 4px;">error</span>
                            <p id="if_node_variables_error_message" style="font-size: 0.8em;">failed to analyze variables</p>
                        </div>
                    </div>
                </div>

                <div class="form_group" style="flex-shrink: 0; margin-top: auto;">
                    <button class="btn btn_secondary btn_danger_subtle" id="delete_node_from_sidebar" style="width: 100%; text-transform: capitalize;">
                        <span class="material-icons">delete</span>
                        <span class="btn_label">Delete Node</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- multi-select properties -->
        <div class="properties_content" id="multi_select_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label">selected nodes</label>
                    <div id="selected_nodes_list" style="max-height: 200px; overflow-y: auto; background: var(--surface-variant); border-radius: 4px; padding: 8px;">
                        <!-- selected nodes will be listed here -->
                    </div>
                </div>
                <div class="form_group">
                    <button class="btn btn_primary" id="create_group_btn" style="width: 100%; margin-bottom: 8px;">
                        <span class="material-icons">group_work</span>
                        create group
                    </button>
                    <button class="btn btn_secondary" id="align_nodes_btn" style="width: 100%; margin-bottom: 8px;">
                        <span class="material-icons">align_horizontal_center</span>
                        align nodes
                    </button>
                    <button class="btn btn_secondary btn_danger_subtle" id="delete_selected_nodes" style="width: 100%;">
                        <span class="material-icons">delete</span>
                        <span style="display: inline-block; margin-bottom: 2px;">Delete Selected</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- link properties -->
        <div class="properties_content" id="link_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label">connection</label>
                    <div style="background: var(--surface-variant); border-radius: 4px; padding: 12px; margin-bottom: 16px; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span id="link_source_name" style="font-weight: 500;">source node</span>
                            <span class="material-icons" style="color: var(--primary-color);">arrow_downward</span>
                            <span id="link_target_name" style="font-weight: 500;">target node</span>
                        </div>
                        <div style="font-size: 0.8em; opacity: 0.7;">
                            <span id="link_source_file">source_file.py</span> → <span id="link_target_file">target_file.py</span>
                        </div>
                    </div>
                </div>
                
                <!-- if-to-python connection variables dropdown -->
                <div class="form_group" id="if_connection_variables_section" style="display: none;">
                    <label class="form_label">if conditions</label>
                    <div style="background: var(--surface-variant); border-radius: 4px; padding: 12px; margin-bottom: 16px;">
                        <div id="if_variables_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">hourglass_empty</span>
                            <p>analyzing python node returns...</p>
                        </div>
                        <div id="if_variables_list" style="display: none;">
                              <select id="if_variables_dropdown" class="form_input" style="width: 100%; margin-bottom: 8px;">
                                <option value="">select a variable</option>
                            </select>
                              

                              <!-- condition builder for if→python connection -->
                              <div id="if_condition_builder" style="margin-top: 12px;">
                                  <div style="display: grid; grid-template-columns: 1fr; row-gap: 10px; align-items: start;">
                                      <div id="if_combiner_container">
                                          <label class="form_label" style="margin: 0 0 6px 0;">combiner</label>
                                          <select id="if_condition_combiner" class="form_input">
                                              <option value="and">and</option>
                                              <option value="or">or</option>
                                          </select>
                                      </div>
                                      <div>
                                          <label class="form_label" style="margin: 0 0 6px 0;">operator</label>
                                          <select id="if_operator_dropdown" class="form_input">
                                              <option value="==">==</option>
                                              <option value="===">===</option>
                                              <option value=">">></option>
                                              <option value="<"><</option>
                                              <option value=">=">>=</option>
                                              <option value="<="><=</option>
                                          </select>
                                      </div>
                                      <div>
                                          <label class="form_label" style="margin: 0 0 6px 0;">compare to</label>
                                          <input id="if_compare_value_input" type="text" class="form_input" placeholder="enter value" />
                                      </div>
                                      <div style="display:flex; align-items:flex-end;">
                                          <button id="if_add_condition_btn" class="btn btn_primary" style="width: 100%;">
                                              <span class="material-icons" style="font-size: 18px;">add</span>
                                              add condition
                                          </button>
                                      </div>
                                  </div>

                                  <div id="if_conditions_list" style="margin-top: 12px;">
                                      <!-- conditions will be rendered here -->
                                  </div>
                              </div>
                              <!-- end condition builder -->
                        </div>
                        <div id="if_variables_error" style="display: none; text-align: center; padding: 20px; color: #f44336;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">error</span>
                            <p id="if_variables_error_message">failed to analyze variables</p>
                        </div>
                        <div id="if_variables_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">info</span>
                            <p>no return variables available</p>
                            <p style="font-size: 0.8em; margin-top: 8px;">the python node may not return any data</p>
                        </div>
                    </div>
                </div>
                
                <div class="form_group">
                    <label class="form_label">shared variables</label>
                    <div id="shared_variables_container" style="max-height: 300px; overflow-y: auto;">
                        <div id="variables_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">hourglass_empty</span>
                            <p>analyzing variable dependencies...</p>
                        </div>
                        <div id="variables_list" style="display: none;">
                            <!-- variables will be populated here -->
                        </div>
                        <div id="variables_error" style="display: none; text-align: center; padding: 20px; color: #f44336;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">error</span>
                            <p id="variables_error_message">failed to analyze variables</p>
                        </div>
                        <div id="variables_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">info</span>
                            <p>no shared variables detected</p>
                            <p style="font-size: 0.8em; margin-top: 8px;">variables may be passed through function calls or imports</p>
                        </div>
                    </div>
                </div>
                
                <div class="form_group">
                    <button class="btn btn_secondary" id="refresh_variables_btn" style="width: 100%; margin-bottom: 8px;">
                        <span class="material-icons">refresh</span>
                        refresh analysis
                    </button>
                    <button class="btn btn_secondary btn_danger_subtle" id="delete_link_btn" style="width: 100%;">
                        <span class="material-icons">delete</span>
                        <span style="display: inline-block; margin-bottom: 2px;">Delete Connection</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- group properties -->
        <div class="properties_content" id="group_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label" for="group_name">group name</label>
                    <input type="text" id="group_name" class="form_input" placeholder="enter group name">
                </div>
                <div class="form_group">
                    <label class="form_label" for="group_description">description</label>
                    <textarea id="group_description" class="form_textarea" placeholder="describe this group"></textarea>
                </div>
                <div class="form_group">
                    <label class="form_label">group members</label>
                    <div id="group_members_list" style="max-height: 200px; overflow-y: auto; background: var(--surface-variant); border-radius: 4px; padding: 8px;">
                        <!-- group members will be listed here -->
                    </div>
                </div>
                <div class="form_group">
                    <button class="btn btn_primary" id="save_group_properties" style="width: 100%; margin-bottom: 8px;">
                        <span class="material-icons">save</span>
                        save group
                    </button>
                    <button class="btn btn_secondary" id="ungroup_nodes" style="width: 100%; margin-bottom: 8px;">
                        <span class="material-icons">ungroup</span>
                        ungroup
                    </button>
                    <button class="btn btn_secondary btn_danger_subtle" id="delete_group" style="width: 100%;">
                        <span class="material-icons">delete</span>
                        <span style="display: inline-block; margin-bottom: 2px;">Delete Group</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- run mode execution panel -->
        <div class="properties_content" id="run_execution_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label">console output</label>
                    <div id="console_output_log" style="max-height: 600px; overflow-y: auto; background: #1a1a1a; color: #00ff00; border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 0.8em; white-space: pre-wrap;">
                        <div id="console_content">
                            <!-- console output will be displayed here -->
                        </div>
                    </div>
                </div>
                <div class="form_group">
                    <label class="form_label">execution status</label>
                    <div id="execution_status" style="background: var(--surface-variant); border-radius: 4px; padding: 12px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="color: var(--on-surface); opacity: 0.7;">info</span>
                            <span id="execution_status_text">ready to start execution</span>
                        </div>
                    </div>
                </div>
                
                <div class="form_group">
                    <label class="form_label">node file info</label>
                    <div id="node_file_info" style="background: var(--surface-variant); border-radius: 4px; padding: 12px; margin-bottom: 16px;">
                        <div id="node_file_content">
                            <p style="opacity: 0.7; text-align: center; padding: 20px;">select a node to view file details</p>
                        </div>
                    </div>
                </div>

                <div class="form_group" id="execution_time_group" style="display: none;">
                    <label class="form_label">execution time</label>
                    <div id="execution_time_block" style="background: var(--surface-variant); border-radius: 4px; padding: 12px; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="color: #4caf50; font-size: 18px;">schedule</span>
                            <span id="execution_time_text">0ms</span>
                            <div style="flex: 1;"></div>
                            <span id="execution_timestamp" style="font-size: 0.8em; opacity: 0.7;">--:--:--</span>
                        </div>
                    </div>
                </div>

                <div class="form_group">
                    <label class="form_label">node output (variables)</label>
                    <div id="node_variables_log" style="max-height: 200px; overflow-y: auto; background: #1a1a1a; color: #ffa726; border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 0.8em; white-space: pre-wrap;">
                        <div id="variables_content">
                            <!-- node variables will be displayed here -->
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- execution history panel -->
        <div class="properties_content" id="execution_history_properties">
            <div class="sidebar_content">
                <div class="form_group">
                    <label class="form_label">execution history</label>
                    <div id="history_list" style="max-height: 500px; overflow-y: auto;">
                        <div id="history_loading" style="text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">hourglass_empty</span>
                            <p>loading execution history...</p>
                        </div>
                        <div id="history_content" style="display: none;">
                            <!-- history entries will be populated here -->
                        </div>
                        <div id="history_empty" style="display: none; text-align: center; padding: 20px; color: var(--on-surface); opacity: 0.7;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">history</span>
                            <p>no execution history found</p>
                            <p style="font-size: 0.8em; margin-top: 8px;">run the flowchart to create history entries</p>
                        </div>
                        <div id="history_error" style="display: none; text-align: center; padding: 20px; color: #f44336;">
                            <span class="material-icons" style="font-size: 24px; margin-bottom: 8px;">error</span>
                            <p id="history_error_message">failed to load execution history</p>
                        </div>
                    </div>
                </div>

                <div class="form_group">
                    <button class="btn btn_secondary" id="refresh_history_btn" style="width: 100%;">
                        <span class="material-icons">refresh</span>
                        refresh history
                    </button>
                </div>
            </div>
        </div>
        <!-- pinned footer actions -->
        <div class="properties_footer">
            <button class="btn btn_secondary btn_danger_subtle" id="sidebar_delete_btn" style="display: none; text-transform: capitalize;">
                <span class="material-icons">delete</span>
                <span style="display: inline-block; margin-bottom: 2px;">Delete</span>
            </button>
        </div>
    </div>

    <!-- create flowchart modal -->
    <div class="modal_overlay" id="create_flowchart_modal">
        <div class="modal_content">
            <div class="modal_header">
                <h2 class="modal_title">CREATE NEW FLOWCHART</h2>
                <button class="modal_close" id="close_create_modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="form_group">
                <label class="form_label" for="new_flowchart_name">flowchart name</label>
                <input type="text" id="new_flowchart_name" class="form_input" placeholder="enter flowchart name..." maxlength="50">
                <div style="font-size: 0.75rem; color: var(--on-surface); opacity: 0.7; margin-top: 4px;">
                    use letters, numbers, spaces, hyphens, and underscores only
                </div>
            </div>
            <div class="modal_actions">
                <button class="btn_modal btn_modal_secondary" id="cancel_create_flowchart">CANCEL</button>
                <button class="btn_modal btn_modal_primary" id="confirm_create_flowchart">CREATE</button>
            </div>
        </div>
    </div>

    <!-- create python script modal -->
    <div class="modal_overlay" id="create_python_modal">
        <div class="modal_content">
            <div class="modal_header">
                <h2 class="modal_title">CREATE PYTHON SCRIPT</h2>
                <button class="modal_close" id="close_create_python_modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="form_group">
                <label class="form_label" for="new_python_name">script name</label>
                <div class="input_with_suffix">
                    <input type="text" id="new_python_name" class="form_input" placeholder="enter script name" maxlength="100">
                    <span class="input_suffix">.py</span>
                </div>
                <div style="font-size: 0.75rem; color: var(--on-surface); opacity: 0.7; margin-top: 4px;">the file will be created under nodes/</div>
            </div>
            <div class="form_group">
                <label class="form_label">choose folder (under nodes/)</label>
                <div class="mini_explorer" id="mini_explorer">
                    <div class="mini_explorer_toolbar">
                        <button type="button" class="mini_btn" id="mini_up_btn"><span class="material-icons" style="font-size:16px">arrow_upward</span> Up</button>
                        <button type="button" class="mini_btn" id="mini_new_folder_btn"><span class="material-icons" style="font-size:16px">create_new_folder</span> New Folder</button>
                        <div style="font-size:0.8rem; opacity:0.8;">path: <span id="mini_cwd_display">/</span></div>
                    </div>
                    <div class="mini_breadcrumb" id="mini_breadcrumb"></div>
                    <div class="mini_list" id="mini_list"><div style="padding:10px; opacity:0.7;">loading...</div></div>
                    <input type="hidden" id="mini_selected_path" value="">
                </div>
                <div style="font-size: 0.75rem; color: var(--on-surface); opacity: 0.7; margin-top: 6px;">files will be ignored here; pick a folder. default is root of nodes/.</div>
            </div>
            <div class="modal_actions">
                <button class="btn_modal btn_modal_secondary" id="cancel_create_python">CANCEL</button>
                <button class="btn_modal btn_modal_primary" id="confirm_create_python">CREATE</button>
            </div>
        </div>
    </div>

    <!-- utility modules -->
    <script src="/static/js/utils/EventEmitter.js"></script>
    <script src="/static/js/utils/Geometry.js"></script>
    <script src="/static/js/utils/Storage.js"></script>
    <script src="/static/js/utils/Validation.js"></script>
    <script src="/static/js/utils/URLManager.js"></script>

    <!-- core modules -->
    <script src="/static/js/core/StateManager.js"></script>
    <script src="/static/js/core/EventManager.js"></script>

    <!-- interaction modules -->
    <script src="/static/js/interactions/DragHandler.js"></script>
    <script src="/static/js/interactions/SelectionHandler.js"></script>
    <script src="/static/js/interactions/ConnectionHandler.js"></script>

    <!-- rendering modules -->
    <script src="/static/js/rendering/NodeRenderer.js"></script>
    <script src="/static/js/rendering/LinkRenderer.js"></script>
    <script src="/static/js/rendering/GroupRenderer.js"></script>

    <!-- component modules -->
    <script src="/static/js/components/Sidebar.js"></script>

    <!-- main application -->
    <script src="/static/js/core/FlowchartBuilder.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>